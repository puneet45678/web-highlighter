(()=>{"use strict";function t(t){const e=function(){const t=document.createElement("span");return t.style.backgroundColor="yellow",t.style.cursor="pointer",t.className="web-highlighter-span",t}();console.log(e);try{t.surroundContents(e)}catch(n){const o=t.extractContents();e.appendChild(o),t.insertNode(e)}}function e(t){let e=t.startContainer,r=t.startOffset,s=t.endContainer,i=t.endOffset;for(;e.nodeType===Node.ELEMENT_NODE&&e.childNodes[r];)e=e.childNodes[r],r=0;if(e.nodeType===Node.ELEMENT_NODE){const t=n(e);t&&(e=t,r=0)}for(;s.nodeType===Node.ELEMENT_NODE&&i>0&&s.childNodes[i-1];)s=s.childNodes[i-1],i=s.nodeType===Node.TEXT_NODE?s.textContent.length:s.childNodes.length;if(s.nodeType===Node.ELEMENT_NODE){const t=o(s);t&&(s=t,i=t.textContent.length)}return{startContainer:e,startOffset:r,endContainer:s,endOffset:i}}function n(t){if(t.nodeType===Node.TEXT_NODE)return t;for(let e of t.childNodes){const t=n(e);if(t)return t}return null}function o(t){if(t.nodeType===Node.TEXT_NODE)return t;for(let e=t.childNodes.length-1;e>=0;e--){const n=o(t.childNodes[e]);if(n)return n}return null}function r(t){if(t.nodeType===Node.TEXT_NODE){const e=t.parentNode,n=Array.from(e.childNodes).filter(t=>t.nodeType===Node.TEXT_NODE).indexOf(t)+1;return r(e)+`/text()[${n}]`}if(t===document.body)return"/html/body";const e=Array.from(t.parentNode.children).filter(e=>e.tagName===t.tagName).indexOf(t)+1;return r(t.parentNode)+"/"+t.tagName.toLowerCase()+`[${e}]`}function s(t,e,n,o=30){const r=t.textContent;return{prefix:r.substring(Math.max(0,e-o),e),suffix:r.substring(n,Math.min(r.length,n+o))}}function i(t){return document.evaluate(t,document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}console.log("[Highlighter] Restoring highlights");const d=JSON.parse(localStorage.getItem("highlights")||"[]");console.log("Stored highlights:",d),d.forEach(function(e){console.log("Trying XPath:",e.start.xpath);const n=i(e.start.xpath),o=i(e.end.xpath);if(console.log("Resolved startNode:",n),!n||!o)return;const r=document.createRange();r.setStart(n,e.start.offset),r.setEnd(o,e.end.offset),t(r)}),document.addEventListener("mouseup",()=>{const n=window.getSelection();if(!n||n.isCollapsed)return;const o=n.getRangeAt(0);if(!o.toString().trim())return;t(o);const i=function(t){const n=e(t),o=n.startContainer,i=n.endContainer;return{text:t.toString(),start:{xpath:r(o),offset:n.startOffset},end:{xpath:r(i),offset:n.endOffset},context:s(o,n.startOffset,n.endOffset)}}(o);!function(t){const e="highlights",n=JSON.parse(localStorage.getItem(e)||"[]");n.push(t),localStorage.setItem(e,JSON.stringify(n))}(i),console.log("Serialized highlight:",i),n.removeAllRanges()})})();
//# sourceMappingURL=content.bundle.js.map